<html>
	<head>
		<script>
			function getDate() {
				let date = new Date();
				date.setHours(0);
				date.setMinutes(0);
				date.setSeconds(0);
				return date;
			}

			function formatTime(date) {
				return `${String(date.getHours()).padStart(2, "0")}:${String(
					date.getMinutes()
				).padStart(2, "0")}:${String(date.getSeconds()).padStart(2, "0")},000`;
			}

			function escapeRegExp(string) {
				return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
			}

			function* getLines(text, separators, length) {
				const separatorRegEx = new RegExp(`[${escapeRegExp(separators)}]`);
				let line = "";
				for (let element of text.split(separatorRegEx)) {
					console.info(line, element);
					element = element.trim();
					if (line.length + element.length > length && line !== "") {
						yield line;
						line = "";
					}
					line += " " + element;
				}
				yield line;
			}

			function generateSrt(text, separators, length) {
				let srt = "";
				let count = 0;
				for (const line of getLines(text, separators, length)) {
					let inTime = getDate();
					let outTime = getDate();
					inTime.setSeconds(5 * count);
					outTime.setSeconds(5 * count + 4);
					count++;
					srt += `${count}\n${formatTime(inTime)} --> ${formatTime(
						outTime
					)}\n${line.trim()}\n\n`;
				}
				return srt;
			}

			window.addEventListener("load", () => {
				document.querySelector("#doit").addEventListener("click", () => {
					const text = document.querySelector("#in").value;
					const separators = document.querySelector("#separators").value;
					const length = document.querySelector("#length").value;
					document.querySelector("#out").value = generateSrt(
						text,
						separators,
						length
					);
				});
			});
		</script>
		<style>
			.command {
				height: 2rem;
				text-align: center;
			}
			.container {
				display: flex;
				flex-wrap: wrap;
				height: calc(100vh - 2rem);
			}
			.half {
				padding: 1rem;
				flex-grow: 1;
			}
			#in,
			#out {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<div class="command">
			<label>
				Separators:
				<input id="separators" />
			</label>
			<label>
				Max. Length:
				<input id="length" value="30" />
			</label>
			<button id="doit">Do it</button>
		</div>
		<div class="container">
			<div class="half">
				<textarea id="in"></textarea>
			</div>
			<div class="half">
				<textarea id="out"></textarea>
			</div>
		</div>
	</body>
</html>
